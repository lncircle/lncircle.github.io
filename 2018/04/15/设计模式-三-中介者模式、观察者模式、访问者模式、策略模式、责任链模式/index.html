<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author"><title>设计模式(三)----中介者模式、观察者模式、访问者模式、策略模式、责任链模式 · lncircle</title><meta name="description" content="中介者模式在一些很多对象之间会存在一定的交互，例如像即时聊天软件中的语言视频通话，这种就有很多的界面变化、如呼入中、呼出中、通话中、视频中、免提，等等多种UI状态，点击相应的按钮，界面其它的UI元素也会随之改变。我们就可以使用中介者模式，进行统一管理、统一调度。同样的在iOSAPP中我们的控制器界面"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">lncircle</a></h3></div></div><ul class="social-links"></ul><div class="footer"><a target="_blank" href="/"><span> ©2018 lncircle</span><span></span></a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">Home</a></li><li><a href="/about">Sobre</a></li><li><a href="/archives">Arquivo</a></li><li><a href="/links">Links</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>设计模式(三)----中介者模式、观察者模式、访问者模式、策略模式、责任链模式</a></h3></div><div class="post-content"><h2 id="中介者模式"><a href="#中介者模式" class="headerlink" title="中介者模式"></a>中介者模式</h2><p>在一些很多对象之间会存在一定的交互，例如像即时聊天软件中的语言视频通话，这种就有很多的界面变化、如呼入中、呼出中、通话中、视频中、免提，等等多种UI状态，点击相应的按钮，界面其它的UI元素也会随之改变。我们就可以使用中介者模式，进行统一管理、统一调度。同样的在iOSAPP中我们的控制器界面也同样可以使用这种管理模式，例如我们的界面控制单元有启动页、登录页、主页面另外还可以有广告页，我们就可以使用一个主控制器来统一管理分配改展示什么页面。</p>
<p>中介者模式类图：<br><img src="/2018/04/15/设计模式-三-中介者模式、观察者模式、访问者模式、策略模式、责任链模式/中介者模式类图.png" alt="avatar"></p>
<p>图中我们可以通过RootViewController来统一调度页面的展示在APP上。</p>
<p>UniversalApp模型的实现</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (void)loadLaunchViewController</span><br><span class="line">&#123;</span><br><span class="line">    [self addChildViewController:_launchVc];</span><br><span class="line">&#125;</span><br><span class="line">- (void)loadLoginViewController</span><br><span class="line">&#123;</span><br><span class="line">    [self addChildViewController:_loginVc];</span><br><span class="line">&#125;</span><br><span class="line">- (void)loadMainViewController</span><br><span class="line">&#123;</span><br><span class="line">    [self addChildViewController:_mainVc];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>本节<a href="https://github.com/lncircle/Proxy-pattern/tree/master/Mediator-%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F" target="_blank" rel="noopener">工程示例</a></p>
<h2 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h2><p>当一个对象的状态和信息发生改变的时候，其它许多和它相关的对象也需要作出相应的变化的场景时，我们就可以使用观察者模式。就像订阅报纸一样，我需要报纸就先订阅，然后新的期刊到来时，就会收到新来的报纸。观察者模式</p>
<p>观察者模式类图<br><img src="/2018/04/15/设计模式-三-中介者模式、观察者模式、访问者模式、策略模式、责任链模式/观察者模式类图.png" alt="avatar"></p>
<p>SubjectCenter的实现</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">static SubjectCenter *center = nil;</span><br><span class="line"></span><br><span class="line">+ (instancetype)sharedInstance&#123;</span><br><span class="line">    static dispatch_once_t once;</span><br><span class="line">    dispatch_once(&amp;once, ^&#123;</span><br><span class="line">        center = [[SubjectCenter alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">return</span> center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)init</span><br><span class="line">&#123;</span><br><span class="line">    self = [super init];</span><br><span class="line">    <span class="keyword">if</span> (self) &#123;</span><br><span class="line">        _bookCenter = [NSMutableDictionary dictionary];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 创建书刊订阅号</span><br><span class="line">- (void)creatNumber:(NSString *)subNumber &#123;</span><br><span class="line">    NSMutableArray *arr = [self existNumber:subNumber];</span><br><span class="line">    <span class="keyword">if</span> (arr == nil) &#123;</span><br><span class="line">        arr = [NSMutableArray array];</span><br><span class="line">        [_bookCenter setObject:arr forKey:subNumber];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 移除订阅号</span><br><span class="line">- (void)removeNumber:(NSString *)subNumber &#123;</span><br><span class="line">    NSMutableArray *arr = [self existNumber:subNumber];</span><br><span class="line">    <span class="keyword">if</span> (arr == nil) &#123;</span><br><span class="line">        arr = [NSMutableArray array];</span><br><span class="line">        [_bookCenter removeObjectForKey:subNumber];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 添加用户</span><br><span class="line">- (void)addUser:(id &lt;ObserveProtocol&gt;)user wihtNumber:(NSString *)userNumber &#123;</span><br><span class="line">    NSMutableArray *arr = [self existNumber:userNumber];</span><br><span class="line">    [arr addObject:user];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 移除用户</span><br><span class="line">- (void)removeUser:(id &lt;ObserveProtocol&gt;)user withNumber:(NSString *)userNumber &#123;</span><br><span class="line">    NSMutableArray *arr = [self existNumber:userNumber];</span><br><span class="line">    [arr removeObject:user];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 发送消息</span><br><span class="line">- (void)sendMessage:(id)message withSubNumber:(NSString *)userNumber &#123;</span><br><span class="line">    NSMutableArray *arr = [self existNumber:userNumber];</span><br><span class="line">    <span class="keyword">if</span> (arr) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (id&lt;ObserveProtocol&gt; observe <span class="keyword">in</span> arr) &#123;</span><br><span class="line">            <span class="keyword">if</span> ([observe respondsToSelector:@selector(subMessage:withSubNumber:)]) &#123;</span><br><span class="line">                [observe subMessage:message withSubNumber:userNumber];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSMutableArray *)existNumber:(NSString *)subStringNumber &#123;</span><br><span class="line">    <span class="built_in">return</span> [_bookCenter objectForKey:subStringNumber];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在iOS的系统中，我们常用的有通知模式和键值编码的形式，前者以广播形式发送特定的消息，而后者则是被观察的对象直接向观察者发送通知，绑定特定对象属性的值。</p>
<p>本节<a href="https://github.com/lncircle/Proxy-pattern/tree/master/Observe-%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F" target="_blank" rel="noopener">工程示例</a></p>
<h2 id="访问者模式"><a href="#访问者模式" class="headerlink" title="访问者模式"></a>访问者模式</h2><p>在一些对象结构中，如果要对其中的对象进行很多不相关操作的时候，又不想让这些操作迫使这些对象的类混乱，我们便可以将这些操作集中起来，定义在一个访问者类中，并在访问者中定义的操作使用它。对这些对象进行依赖一些的具体类型的操作还有添加新的操作都可以使用这种访问者模式。也就是在不改变各元素类的前提下定义作用于这些元素的新操作。例如我们的开发者有安卓开发和iOS开发者，分别进行OA签到和Git上传代码，就可以使用访问者模式，去相关服务器进行操作而不改变服务器。访问者模式用尽可能的修改，可以把组合结构与其他的访问者类中的相关算法分离。</p>
<p>访问者模式类图：</p>
<p><img src="/2018/04/15/设计模式-三-中介者模式、观察者模式、访问者模式、策略模式、责任链模式/访问者模式类图.png" alt="avantar"></p>
<p>实例代码中实现了iOS开发者访问OA服务器的签到和Git服务器的下载代码功能。<br>其中GitWebsite的实现</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (void)acceptDeveloper:(Developer *)developer</span><br><span class="line">&#123;</span><br><span class="line">    [self doSomething];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)doSomething</span><br><span class="line">&#123;</span><br><span class="line">    NSLog(@<span class="string">"下载iOS代码"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>本节<a href="https://github.com/lncircle/Proxy-pattern/tree/master/Visitor-%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F" target="_blank" rel="noopener">工程示例</a></p>
<h2 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h2><p>在开发中我们往往根据不同情况使用不同的算法，一般会使用if-else或者switch-case条件语句来进行判断，如果算法过多的话往往比较复杂并且难以维护。这个时候将不同的算法一个个的封装起来，并使他们可以相互替换，就可以避免了多重条件的判断，并且拥有良好的扩展性。例如我们出去旅游，有多种旅行方式，我们把每种出行方式封装成单独的一个对象来实现。</p>
<p>策略模式类图：</p>
<p><img src="/2018/04/15/设计模式-三-中介者模式、观察者模式、访问者模式、策略模式、责任链模式/策略模式类图.png" alt="avantar"></p>
<p>TravelStrategy根据不同的算法接口，实现不同的出行方式。</p>
<p>TravelStrategy的实现</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (id)initWithTravelStrategy:(TravelStrategy *)strategy</span><br><span class="line">&#123;</span><br><span class="line">    self = [super init];</span><br><span class="line">    <span class="keyword">if</span> (self) &#123;</span><br><span class="line">        _strategy = strategy;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)travel</span><br><span class="line">&#123;</span><br><span class="line">    [_strategy travel];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>本节<a href="https://github.com/lncircle/Proxy-pattern/tree/master/Strategy-%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F" target="_blank" rel="noopener">工程示例</a></p>
<h2 id="责任链模式"><a href="#责任链模式" class="headerlink" title="责任链模式"></a>责任链模式</h2><p>在一些有多个对象可以处理请求，而处理只有在运行的时候才能确定的场景下，包括向一组对象发出请求，又不想显示的指定处理请求的特定处理程序的场景下，我们就可以使用责任链模式进行程序设计。这使得多个对象都有机会处理请求，也避免了发送者和接收者之间发生耦合。这种模式将这些对象连成一条链，将请求沿着这条链传递，直到有一个对象处理为止。例如，在公司进行财务审批，组长能审批不大于1000的金额，超过的话交给经理来处理，但超过100000的话，只能交给老板来审批了。</p>
<p>责任链模式类图：</p>
<p><img src="/2018/04/15/设计模式-三-中介者模式、观察者模式、访问者模式、策略模式、责任链模式/责任链模式类图.png" alt="avantar"></p>
<p>MemberModel定义了统一的接口,它的操作可以通过递归传达到借点的每一处。</p>
<p>其中ApplyHander的实现</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (void)handleApplyMoneyCount:(NSInteger)moneyCount</span><br><span class="line">&#123;</span><br><span class="line">    [self.nextHander handleApplyMoneyCount:moneyCount];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>GroupLeaderHander的实现</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (void)handleApplyMoneyCount:(NSInteger)moneyCount</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (moneyCount &lt;= 1000) &#123;</span><br><span class="line">        NSLog(@<span class="string">"组长通过了审批"</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        [super handleApplyMoneyCount:moneyCount];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ManagerHander的实现</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (void)handleApplyMoneyCount:(NSInteger)moneyCount</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (moneyCount &lt;= 10000) &#123;</span><br><span class="line">        NSLog(@<span class="string">"经历通过了审批"</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        [super handleApplyMoneyCount:moneyCount];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>BossManager的实现</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (void)handleApplyMoneyCount:(NSInteger)moneyCount</span><br><span class="line">&#123;</span><br><span class="line">    NSLog(@<span class="string">"老板通过了审批"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>客户端的调用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">NSInteger moneyCount = 99999;</span><br><span class="line"></span><br><span class="line">GroupLeaderHander *groupLeader = [[GroupLeaderHander alloc] init];</span><br><span class="line">ManagerHander *manager = [[ManagerHander alloc] init];</span><br><span class="line">BossManager *boss = [[BossManager alloc] init];</span><br><span class="line"></span><br><span class="line">groupLeader.nextHander = manager;</span><br><span class="line">manager.nextHander = boss;</span><br><span class="line"></span><br><span class="line">[groupLeader handleApplyMoneyCount:moneyCount];</span><br></pre></td></tr></table></figure>
<p>本节<a href="https://github.com/lncircle/Proxy-pattern/tree/master/ChainOfResponsibility-%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F" target="_blank" rel="noopener">工程示例</a></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-04-15</span><i class="fa fa-tag"></i></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,http://yoursite.com/2018/04/15/设计模式-三-中介者模式、观察者模式、访问者模式、策略模式、责任链模式/,lncircle,设计模式(三)----中介者模式、观察者模式、访问者模式、策略模式、责任链模式,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2018/08/27/设计模式-四-解释器模式、迭代器模式、命令模式、状态模式、备忘录模式、模板方法模式/" title="设计模式(四)----解释器模式、迭代器模式、命令模式、状态模式、备忘录模式、模板方法模式">Post Anterior</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2018/04/08/设计模式-二-桥接模式、适配器模式、外观模式、组合模式、装饰模式、享元模式、代理模式/" title="设计模式(二)----桥接模式、适配器模式、外观模式、组合模式、装饰模式、享元模式、代理模式">Próximo post</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>